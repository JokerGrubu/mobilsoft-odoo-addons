<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Account Move Form View Extension -->
    <record id="view_move_form_qnb" model="ir.ui.view">
        <field name="name">account.move.form.qnb</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="action_check_qnb_status"
                        string="QNB Durum Kontrol"
                        type="object"
                        class="btn-secondary"
                        invisible="not qnb_ettn"/>
            </xpath>

            <!-- e-Belge Bilgileri Tab -->
            <xpath expr="//page[@id='other_tab']" position="after">
                <page string="e-Belge" name="qnb_info"
                      invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund')">
                    <group>
                        <group string="e-Belge Durumu">
                            <field name="qnb_state" widget="badge"
                                   decoration-info="qnb_state == 'sending'"
                                   decoration-success="qnb_state in ('sent', 'delivered', 'accepted')"
                                   decoration-danger="qnb_state in ('rejected', 'error')"
                                   decoration-muted="qnb_state == 'not_sent'"/>
                            <field name="qnb_document_type"/>
                            <field name="qnb_ettn" invisible="not qnb_ettn"/>
                        </group>
                        <group string="Müşteri e-Fatura Bilgileri">
                            <field name="partner_id" invisible="1"/>
                            <label for="partner_id" string="e-Fatura Kayıtlı"/>
                            <div>
                                <span class="badge text-bg-success" invisible="not partner_id.is_efatura_registered">Evet</span>
                                <span class="badge text-bg-warning" invisible="partner_id.is_efatura_registered">Hayır</span>
                            </div>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
