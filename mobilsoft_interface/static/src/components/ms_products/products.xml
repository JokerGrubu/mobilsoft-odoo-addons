<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">

<!-- ================================================
     √úR√úNLER MOD√úL√ú - Wrapper
================================================ -->
<t t-name="mobilsoft_interface.ProductsModule">
    <t t-if="state.view === 'list'">
        <ProductsList
            onEdit="(id) => showEdit(id)"
            onNew="() => showNew()"
        />
    </t>
    <t t-else="">
        <ProductForm
            id="state.editId"
            onBack="() => showList()"
            onSaved="() => onSaved()"
        />
    </t>
</t>

<!-- ================================================
     √úR√úN Lƒ∞STESƒ∞
================================================ -->
<t t-name="mobilsoft_interface.ProductsList">
    <div class="ms-page">

        <!-- Ba≈ülƒ±k -->
        <div class="ms-page__header">
            <div>
                <h1 class="ms-page__title">üì¶ √úr√ºnler</h1>
                <p class="ms-page__subtitle"><t t-esc="state.total"/> √ºr√ºn</p>
            </div>
            <div class="ms-page__actions">
                <button class="ms-btn ms-btn--primary" t-on-click="() => props.onNew()">
                    + Yeni √úr√ºn
                </button>
            </div>
        </div>

        <!-- Ara√ß √ßubuƒüu -->
        <div class="ms-toolbar">
            <div class="ms-search">
                <span class="ms-search__icon">üîç</span>
                <input
                    class="ms-search__input"
                    type="text"
                    placeholder="ƒ∞sim veya barkod ara..."
                    t-att-value="state.search"
                    t-on-input="onSearch"
                />
            </div>
            <div class="ms-tabs">
                <button
                    t-attf-class="ms-tab{{ state.filter === 'active' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('active')">Aktif</button>
                <button
                    t-attf-class="ms-tab{{ state.filter === 'all' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('all')">T√ºm√º</button>
                <button
                    t-attf-class="ms-tab{{ state.filter === 'low_stock' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('low_stock')">Kritik Stok</button>
                <button
                    t-attf-class="ms-tab{{ state.filter === 'archived' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('archived')">Ar≈üiv</button>
            </div>
        </div>

        <!-- Tablo -->
        <div class="ms-table-container">
            <t t-if="state.loading">
                <div class="ms-spinner">√úr√ºnler y√ºkleniyor...</div>
            </t>
            <t t-elif="state.records.length === 0">
                <div class="ms-empty">
                    <div class="ms-empty__icon">üì¶</div>
                    <p class="ms-empty__title">√úr√ºn bulunamadƒ±</p>
                    <p class="ms-empty__desc">Arama kriterlerinizi deƒüi≈ütirin veya yeni √ºr√ºn ekleyin.</p>
                    <button class="ms-btn ms-btn--primary" t-on-click="() => props.onNew()">+ Yeni √úr√ºn</button>
                </div>
            </t>
            <t t-else="">
                <table class="ms-table">
                    <thead>
                        <tr>
                            <th style="width:44px"></th>
                            <th>√úr√ºn Adƒ±</th>
                            <th>Barkod</th>
                            <th>Kategori</th>
                            <th>Satƒ±≈ü Fiyatƒ±</th>
                            <th>Stok</th>
                            <th>Tip</th>
                            <th style="width:60px"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="state.records" t-as="rec" t-key="rec.id">
                            <tr t-on-click="() => props.onEdit(rec.id)">
                                <td>
                                    <t t-if="rec.image_128">
                                        <img
                                            class="ms-table__img"
                                            t-attf-src="data:image/png;base64,{{rec.image_128}}"
                                            alt=""
                                        />
                                    </t>
                                    <t t-else="">
                                        <div class="ms-table__img-placeholder">üì¶</div>
                                    </t>
                                </td>
                                <td><strong><t t-esc="rec.name"/></strong></td>
                                <td style="font-family:monospace; font-size:12px; color:#666">
                                    <t t-esc="rec.barcode || '‚Äî'"/>
                                </td>
                                <td><t t-esc="rec.categ_id ? rec.categ_id[1] : '‚Äî'"/></td>
                                <td style="font-weight:600; color:#2D6A4F">
                                    ‚Ç∫ <t t-esc="formatPrice(rec.list_price)"/>
                                </td>
                                <td>
                                    <t t-set="stockInfo" t-value="getStockBadge(rec)"/>
                                    <t t-if="stockInfo">
                                        <span t-attf-class="ms-badge {{ stockInfo.class }}">
                                            <t t-esc="stockInfo.label"/>
                                        </span>
                                    </t>
                                    <t t-else="">
                                        <span class="ms-badge ms-badge--muted">Hizmet</span>
                                    </t>
                                </td>
                                <td>
                                    <span class="ms-badge ms-badge--muted">
                                        <t t-esc="getTypeLabel(rec.type)"/>
                                    </span>
                                </td>
                                <td t-on-click.stop="() => props.onEdit(rec.id)">
                                    <button class="ms-btn ms-btn--secondary ms-btn--sm">‚úèÔ∏è</button>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <!-- Sayfalama -->
                <div class="ms-pagination">
                    <span class="ms-pagination__info">
                        <t t-esc="pageStart"/> ‚Äì <t t-esc="pageEnd"/> / <t t-esc="state.total"/> kayƒ±t
                    </span>
                    <div class="ms-pagination__controls">
                        <button
                            class="ms-pagination__btn"
                            t-att-disabled="state.offset &lt;= 0"
                            t-on-click="prevPage">‚óÄ √ñnceki</button>
                        <span style="padding: 5px 12px; font-size:13px">
                            <t t-esc="currentPage"/> / <t t-esc="totalPages"/>
                        </span>
                        <button
                            class="ms-pagination__btn"
                            t-att-disabled="state.offset + state.limit >= state.total"
                            t-on-click="nextPage">Sonraki ‚ñ∂</button>
                    </div>
                </div>
            </t>
        </div>

    </div>
</t>

<!-- ================================================
     √úR√úN FORMU
================================================ -->
<t t-name="mobilsoft_interface.ProductForm">
    <div class="ms-form-page">

        <!-- Form ba≈ülƒ±ƒüƒ± -->
        <div class="ms-form-header">
            <button class="ms-form-back" t-on-click="props.onBack" title="Geri d√∂n">‚Üê</button>
            <h1 class="ms-form-title">
                <t t-if="props.id">√úr√ºn D√ºzenle</t>
                <t t-else="">Yeni √úr√ºn</t>
            </h1>
        </div>

        <!-- Y√ºkleniyor -->
        <t t-if="state.loading">
            <div class="ms-spinner">√úr√ºn y√ºkleniyor...</div>
        </t>

        <t t-else="">
            <!-- Temel Bilgiler -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">Temel Bilgiler</p>
                <div class="ms-form-row">

                    <div class="ms-form-group ms-form-group--full">
                        <label class="ms-form-label">
                            √úr√ºn Adƒ± <span class="ms-form-required">*</span>
                        </label>
                        <input
                            class="ms-form-input"
                            type="text"
                            placeholder="√úr√ºn adƒ±nƒ± girin"
                            t-att-value="state.record.name"
                            t-on-input="(e) => updateField('name', e.target.value)"
                        />
                        <t t-if="state.errors.name">
                            <span class="ms-form-error"><t t-esc="state.errors.name"/></span>
                        </t>
                    </div>

                    <div class="ms-form-group">
                        <label class="ms-form-label">Barkod</label>
                        <input
                            class="ms-form-input"
                            type="text"
                            placeholder="Barkod (opsiyonel)"
                            t-att-value="state.record.barcode"
                            t-on-input="(e) => updateField('barcode', e.target.value)"
                        />
                    </div>

                    <div class="ms-form-group">
                        <label class="ms-form-label">Kategori</label>
                        <select
                            class="ms-form-select"
                            t-on-change="(e) => updateField('categ_id', parseInt(e.target.value) || false)"
                        >
                            <option value="">-- Se√ßiniz --</option>
                            <t t-foreach="state.categories" t-as="cat" t-key="cat.id">
                                <option
                                    t-att-value="cat.id"
                                    t-att-selected="state.record.categ_id === cat.id"
                                >
                                    <t t-esc="cat.name"/>
                                </option>
                            </t>
                        </select>
                    </div>

                    <div class="ms-form-group">
                        <label class="ms-form-label">√úr√ºn Tipi</label>
                        <select
                            class="ms-form-select"
                            t-on-change="(e) => updateField('type', e.target.value)"
                        >
                            <option value="consu" t-att-selected="state.record.type === 'consu'">Sarf Malzeme</option>
                            <option value="product" t-att-selected="state.record.type === 'product'">Stoklanabilir</option>
                            <option value="service" t-att-selected="state.record.type === 'service'">Hizmet</option>
                        </select>
                    </div>

                </div>
            </div>

            <!-- Fiyatlandƒ±rma -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">Fiyatlandƒ±rma</p>
                <div class="ms-form-row">

                    <div class="ms-form-group">
                        <label class="ms-form-label">Satƒ±≈ü Fiyatƒ± (‚Ç∫)</label>
                        <input
                            class="ms-form-input"
                            type="number"
                            min="0"
                            step="0.01"
                            placeholder="0,00"
                            t-att-value="state.record.list_price"
                            t-on-input="(e) => updateField('list_price', e.target.value)"
                        />
                        <t t-if="state.errors.list_price">
                            <span class="ms-form-error"><t t-esc="state.errors.list_price"/></span>
                        </t>
                    </div>

                    <div class="ms-form-group">
                        <label class="ms-form-label">Maliyet Fiyatƒ± (‚Ç∫)</label>
                        <input
                            class="ms-form-input"
                            type="number"
                            min="0"
                            step="0.01"
                            placeholder="0,00"
                            t-att-value="state.record.standard_price"
                            t-on-input="(e) => updateField('standard_price', e.target.value)"
                        />
                    </div>

                </div>
            </div>

            <!-- Ek Bilgiler -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">Ek Bilgiler</p>

                <div class="ms-form-group">
                    <label class="ms-form-label">Satƒ±≈ü A√ßƒ±klamasƒ±</label>
                    <textarea
                        class="ms-form-textarea"
                        placeholder="M√º≈üterilere g√∂sterilecek a√ßƒ±klama (opsiyonel)"
                        t-att-value="state.record.description_sale"
                        t-on-input="(e) => updateField('description_sale', e.target.value)"
                    />
                </div>

                <div style="margin-top: 16px">
                    <div
                        t-attf-class="ms-toggle{{ state.record.active ? ' ms-toggle--on' : '' }}"
                        t-on-click="toggleActive"
                    >
                        <div class="ms-toggle__switch"></div>
                        <span class="ms-toggle__label">
                            <t t-if="state.record.active">Aktif</t>
                            <t t-else="">Pasif (Ar≈üivlenmi≈ü)</t>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Kaydet / ƒ∞ptal -->
            <div class="ms-form-footer">
                <button class="ms-btn ms-btn--secondary" t-on-click="props.onBack">
                    ƒ∞ptal
                </button>
                <button
                    class="ms-btn ms-btn--primary"
                    t-att-disabled="state.saving"
                    t-on-click="save"
                >
                    <t t-if="state.saving">‚è≥ Kaydediliyor...</t>
                    <t t-else="">‚úì Kaydet</t>
                </button>
            </div>
        </t>

    </div>
</t>

</templates>
