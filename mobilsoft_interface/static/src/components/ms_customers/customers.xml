<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">

<!-- ================================================
     CARƒ∞LER MOD√úL√ú - Wrapper
================================================ -->
<t t-name="mobilsoft_interface.CustomersModule">
    <t t-if="state.view === 'list'">
        <CustomersList
            onEdit="(id) => showEdit(id)"
            onNew="() => showNew()"
        />
    </t>
    <t t-else="">
        <CustomerForm
            id="state.editId"
            onBack="() => showList()"
            onSaved="() => onSaved()"
        />
    </t>
</t>

<!-- ================================================
     CARƒ∞LER Lƒ∞STESƒ∞
================================================ -->
<t t-name="mobilsoft_interface.CustomersList">
    <div class="ms-page">

        <div class="ms-page__header">
            <div>
                <h1 class="ms-page__title">üë• Cariler</h1>
                <p class="ms-page__subtitle"><t t-esc="state.total"/> cari</p>
            </div>
            <div class="ms-page__actions">
                <button class="ms-btn ms-btn--primary" t-on-click="() => props.onNew()">
                    + Yeni Cari
                </button>
            </div>
        </div>

        <!-- Ara√ß √ßubuƒüu -->
        <div class="ms-toolbar">
            <div class="ms-search">
                <span class="ms-search__icon">üîç</span>
                <input
                    class="ms-search__input"
                    type="text"
                    placeholder="ƒ∞sim, VKN veya telefon ara..."
                    t-att-value="state.search"
                    t-on-input="onSearch"
                />
            </div>
            <div class="ms-tabs">
                <button
                    t-attf-class="ms-tab{{ state.filter === 'all' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('all')">Hepsi</button>
                <button
                    t-attf-class="ms-tab{{ state.filter === 'customers' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('customers')">M√º≈üteriler</button>
                <button
                    t-attf-class="ms-tab{{ state.filter === 'suppliers' ? ' ms-tab--active' : '' }}"
                    t-on-click="() => setFilter('suppliers')">Tedarik√ßiler</button>
            </div>
        </div>

        <!-- Tablo -->
        <div class="ms-table-container">
            <t t-if="state.loading">
                <div class="ms-spinner">Cariler y√ºkleniyor...</div>
            </t>
            <t t-elif="state.records.length === 0">
                <div class="ms-empty">
                    <div class="ms-empty__icon">üë•</div>
                    <p class="ms-empty__title">Cari bulunamadƒ±</p>
                    <p class="ms-empty__desc">Arama kriterlerinizi deƒüi≈ütirin veya yeni cari ekleyin.</p>
                    <button class="ms-btn ms-btn--primary" t-on-click="() => props.onNew()">+ Yeni Cari</button>
                </div>
            </t>
            <t t-else="">
                <table class="ms-table">
                    <thead>
                        <tr>
                            <th>Cari Adƒ±</th>
                            <th>VKN / TCKN</th>
                            <th>Telefon</th>
                            <th>E-posta</th>
                            <th>≈ûehir</th>
                            <th>Tip</th>
                            <th style="width:60px"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="state.records" t-as="rec" t-key="rec.id">
                            <tr t-on-click="() => props.onEdit(rec.id)">
                                <td>
                                    <div style="display:flex; align-items:center; gap:8px">
                                        <span style="font-size:20px">
                                            <t t-if="rec.is_company">üè¢</t>
                                            <t t-else="">üë§</t>
                                        </span>
                                        <strong><t t-esc="rec.name"/></strong>
                                    </div>
                                </td>
                                <td style="font-family:monospace; font-size:12px; color:#666">
                                    <t t-esc="rec.vat || '‚Äî'"/>
                                </td>
                                <td><t t-esc="rec.phone || '‚Äî'"/></td>
                                <td style="font-size:12px; color:#666"><t t-esc="rec.email || '‚Äî'"/></td>
                                <td><t t-esc="rec.city || '‚Äî'"/></td>
                                <td>
                                    <t t-set="typeInfo" t-value="getTypeLabel(rec)"/>
                                    <span t-attf-class="ms-badge {{ typeInfo.cls }}">
                                        <t t-esc="typeInfo.label"/>
                                    </span>
                                </td>
                                <td t-on-click.stop="() => props.onEdit(rec.id)">
                                    <button class="ms-btn ms-btn--secondary ms-btn--sm">‚úèÔ∏è</button>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>

                <div class="ms-pagination">
                    <span class="ms-pagination__info">
                        <t t-esc="pageStart"/> ‚Äì <t t-esc="pageEnd"/> / <t t-esc="state.total"/> kayƒ±t
                    </span>
                    <div class="ms-pagination__controls">
                        <button class="ms-pagination__btn" t-att-disabled="state.offset <= 0" t-on-click="prevPage">‚óÄ √ñnceki</button>
                        <span style="padding: 5px 12px; font-size:13px"><t t-esc="currentPage"/> / <t t-esc="totalPages"/></span>
                        <button class="ms-pagination__btn" t-att-disabled="state.offset + state.limit >= state.total" t-on-click="nextPage">Sonraki ‚ñ∂</button>
                    </div>
                </div>
            </t>
        </div>

    </div>
</t>

<!-- ================================================
     CARƒ∞ FORMU
================================================ -->
<t t-name="mobilsoft_interface.CustomerForm">
    <div class="ms-form-page">

        <div class="ms-form-header">
            <button class="ms-form-back" t-on-click="props.onBack">‚Üê</button>
            <h1 class="ms-form-title">
                <t t-if="props.id">Cari D√ºzenle</t>
                <t t-else="">Yeni Cari</t>
            </h1>
        </div>

        <t t-if="state.loading">
            <div class="ms-spinner">Cari y√ºkleniyor...</div>
        </t>

        <t t-else="">

            <!-- Kimlik Bilgileri -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">Kimlik Bilgileri</p>

                <!-- Bireysel / Kurumsal toggle -->
                <div style="display:flex; gap:8px; margin-bottom:16px">
                    <button
                        t-attf-class="ms-btn {{ !state.record.is_company ? 'ms-btn--primary' : 'ms-btn--secondary' }}"
                        t-on-click="() => updateField('is_company', false)"
                    >üë§ Bireysel</button>
                    <button
                        t-attf-class="ms-btn {{ state.record.is_company ? 'ms-btn--primary' : 'ms-btn--secondary' }}"
                        t-on-click="() => updateField('is_company', true)"
                    >üè¢ Kurumsal</button>
                </div>

                <div class="ms-form-row">
                    <div class="ms-form-group ms-form-group--full">
                        <label class="ms-form-label">
                            <t t-if="state.record.is_company">≈ûirket Adƒ±</t>
                            <t t-else="">Ad Soyad</t>
                            <span class="ms-form-required">*</span>
                        </label>
                        <input
                            class="ms-form-input"
                            type="text"
                            t-att-placeholder="state.record.is_company ? '≈ûirket adƒ±' : 'Ad Soyad'"
                            t-att-value="state.record.name"
                            t-on-input="(e) => updateField('name', e.target.value)"
                        />
                        <t t-if="state.errors.name">
                            <span class="ms-form-error"><t t-esc="state.errors.name"/></span>
                        </t>
                    </div>

                    <div class="ms-form-group">
                        <label class="ms-form-label">
                            <t t-if="state.record.is_company">Vergi Kimlik No (VKN)</t>
                            <t t-else="">TC Kimlik No</t>
                        </label>
                        <input
                            class="ms-form-input"
                            type="text"
                            t-att-placeholder="state.record.is_company ? '10 haneli VKN' : '11 haneli TCKN'"
                            t-att-value="state.record.vat"
                            t-on-input="(e) => updateField('vat', e.target.value)"
                        />
                    </div>

                    <div class="ms-form-group">
                        <!-- M√º≈üteri / Tedarik√ßi se√ßimi -->
                        <label class="ms-form-label">Kategori</label>
                        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:4px">
                            <div
                                t-attf-class="ms-toggle{{ state.record.is_customer ? ' ms-toggle--on' : '' }}"
                                t-on-click="() => updateField('is_customer', !state.record.is_customer)"
                            >
                                <div class="ms-toggle__switch"></div>
                                <span class="ms-toggle__label">M√º≈üteri</span>
                            </div>
                            <div
                                t-attf-class="ms-toggle{{ state.record.is_supplier ? ' ms-toggle--on' : '' }}"
                                t-on-click="() => updateField('is_supplier', !state.record.is_supplier)"
                                style="margin-left:16px"
                            >
                                <div class="ms-toggle__switch"></div>
                                <span class="ms-toggle__label">Tedarik√ßi</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ƒ∞leti≈üim Bilgileri -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">ƒ∞leti≈üim Bilgileri</p>
                <div class="ms-form-row ms-form-row--3">
                    <div class="ms-form-group">
                        <label class="ms-form-label">Telefon</label>
                        <input class="ms-form-input" type="tel" placeholder="+90 ..." t-att-value="state.record.phone" t-on-input="(e) => updateField('phone', e.target.value)" />
                    </div>
                    <div class="ms-form-group">
                        <label class="ms-form-label">Mobil</label>
                        <input class="ms-form-input" type="tel" placeholder="+90 5xx ..." t-att-value="state.record.mobile" t-on-input="(e) => updateField('mobile', e.target.value)" />
                    </div>
                    <div class="ms-form-group">
                        <label class="ms-form-label">E-posta</label>
                        <input class="ms-form-input" type="email" placeholder="ornek@firma.com" t-att-value="state.record.email" t-on-input="(e) => updateField('email', e.target.value)" />
                    </div>
                </div>
            </div>

            <!-- Adres -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">Adres</p>
                <div class="ms-form-row">
                    <div class="ms-form-group ms-form-group--full">
                        <label class="ms-form-label">Sokak / Cadde</label>
                        <input class="ms-form-input" type="text" placeholder="Sokak, cadde, bina no" t-att-value="state.record.street" t-on-input="(e) => updateField('street', e.target.value)" />
                    </div>
                    <div class="ms-form-group">
                        <label class="ms-form-label">≈ûehir / ƒ∞l√ße</label>
                        <input class="ms-form-input" type="text" placeholder="ƒ∞stanbul" t-att-value="state.record.city" t-on-input="(e) => updateField('city', e.target.value)" />
                    </div>
                    <div class="ms-form-group">
                        <label class="ms-form-label">Posta Kodu</label>
                        <input class="ms-form-input" type="text" placeholder="34000" t-att-value="state.record.zip" t-on-input="(e) => updateField('zip', e.target.value)" />
                    </div>
                </div>
            </div>

            <!-- Notlar -->
            <div class="ms-form-card">
                <p class="ms-form-section-title">Notlar</p>
                <div class="ms-form-group">
                    <textarea class="ms-form-textarea" placeholder="Bu cari hakkƒ±nda notlar..." t-att-value="state.record.comment" t-on-input="(e) => updateField('comment', e.target.value)" />
                </div>
            </div>

            <div class="ms-form-footer">
                <button class="ms-btn ms-btn--secondary" t-on-click="props.onBack">ƒ∞ptal</button>
                <button class="ms-btn ms-btn--primary" t-att-disabled="state.saving" t-on-click="save">
                    <t t-if="state.saving">‚è≥ Kaydediliyor...</t>
                    <t t-else="">‚úì Kaydet</t>
                </button>
            </div>

        </t>
    </div>
</t>

</templates>
